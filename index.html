<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Dual Mobile Mockup v0.3 — UNO → DUAL → TRINITY</title>
<meta name="theme-color" content="#0b0f17" />
<link rel="icon" href="assets/icons/app.svg">
<style>
  :root{
    --bg:#0b0f17;--panel:#0f1522;--glass:rgba(255,255,255,.06);--line:rgba(255,255,255,.14);
    --ink:#e9f6ff;--muted:#97b1c6;--accent:#29d3ff;--accent2:#ff5af4;--ok:#39ffb6;--warn:#ffb74d;--err:#ff5a6e;
    --rad:18px;--pad:14px;--shadow:0 12px 40px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.04);
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 800px at 20% -10%, rgba(41,211,255,.14), transparent 60%),
       radial-gradient(900px 600px at 110% 20%, rgba(255,90,244,.10), transparent 60%),
       linear-gradient(0deg, #0a0d14, #0b0f17);
       color:var(--ink);font:500 15px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif}
  .app{position:fixed;inset:0;display:grid;grid-template-rows:auto 1fr auto;}
  header{display:flex;gap:10px;align-items:center;padding:12px env(safe-area-inset-right) 10px env(safe-area-inset-left);}
  .logo{width:36px;height:36px;border-radius:50%;background:conic-gradient(from 0deg, var(--accent), var(--accent2), var(--accent));
        box-shadow:0 0 24px rgba(41,211,255,.4);animation:spin 9s linear infinite}
  @keyframes spin{to{transform:rotate(1turn)}}
  .title{font-weight:800;letter-spacing:.4px}
  .sub{color:var(--muted);font-size:12px}

  .row{display:flex;gap:10px;align-items:center}
  .grow{flex:1}
  .btn{appearance:none;border:1px solid var(--line);background:rgba(255,255,255,.03);color:var(--ink);
       padding:10px 12px;border-radius:14px;font-weight:700;letter-spacing:.3px;box-shadow:var(--shadow);
       display:inline-flex;align-items:center;gap:8px}
  .btn:active{transform:translateY(1px);opacity:.9}
  .chip{font-size:12px;border-radius:999px;border:1px solid var(--line);padding:6px 10px;background:rgba(255,255,255,.04);color:var(--muted)}
  select{appearance:none;background:rgba(255,255,255,.06);color:var(--ink);border:1px solid var(--line);border-radius:12px;padding:8px 10px}

  /* Water-cost badge */
  .water{margin-left:10px;display:flex;gap:8px;align-items:center; flex-wrap:wrap}
  .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);background:rgba(255,255,255,.04);
         padding:6px 8px;border-radius:10px;font-size:11px;color:var(--muted)}
  .ok{color:var(--ok)}.warn{color:var(--warn)}.err{color:var(--err)}

  /* Canvas stage */
  .stage{position:relative;overflow:hidden;margin:6px; border:1px solid var(--line); border-radius:24px; 
         background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
         box-shadow:var(--shadow)}
  canvas{position:absolute;inset:0;width:100%;height:100%}
  .overlay-gestures{position:absolute;inset:0;pointer-events:none;display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--muted)}

  /* Cards / panels */
  .card{background:var(--glass);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);
        border:1px solid var(--line);border-radius:var(--rad);padding:var(--pad);box-shadow:var(--shadow)}

  /* Apps list & iframe sandbox */
  .apps{padding:10px;display:grid;gap:10px}
  .appItem{display:flex;align-items:center;gap:10px}
  .appItem .meta{font-size:12px;color:var(--muted)}
  .sandboxWrap{margin:10px;border:1px solid var(--line);border-radius:16px;overflow:hidden}
  iframe.sandbox{display:block;width:100%;height:380px;background:#0a0d14;border:0}

  /* Modal */
  dialog{border:1px solid var(--line);border-radius:16px;background:rgba(11,15,23,.9);color:var(--ink);padding:0;max-width:92vw}
  dialog::backdrop{background:rgba(0,0,0,.5)}
  .modalHead{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;gap:10px;align-items:center}
  .modalBody{padding:12px 14px}

  /* Floating buttons */
  .fab{position:fixed;right:12px;bottom:calc(84px + env(safe-area-inset-bottom));display:flex;flex-direction:column;gap:10px}
  .fab .btn{padding:10px 12px}

  /* Mini toasts */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(72px + env(safe-area-inset-bottom));
         background:rgba(20,28,44,.9);border:1px solid var(--line);backdrop-filter:blur(10px);padding:8px 12px;border-radius:12px;font-size:12px;color:var(--ink);display:none}
  .toast.show{display:block}

  /* Responsive stage height */
  .stage{height:calc(100vh - 280px)}
  @media (min-height:760px){.stage{height:calc(100vh - 310px)}}

/* === Mobile v0.4 patch === */
html, body { max-width: 100vw; overflow-x: hidden; }
.app-item{display:flex;align-items:center;gap:.6rem;min-width:0}
.app-item .name{min-width:0}
.app-item .name .title,
.app-item .name .file,
.ellip{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-inline-size:18ch}
#btnInfodose{
  position:fixed;bottom:1rem;right:1rem;z-index:1000;width:56px;height:56px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;border:1px solid var(--line);
  background:radial-gradient(120% 120% at 80% 20%, var(--accent2), transparent 60%),
             radial-gradient(120% 120% at 20% 80%, var(--accent), transparent 55%),
             rgba(255,255,255,.06);
  box-shadow:0 10px 30px rgba(0,0,0,.35), 0 0 24px rgba(41,211,255,.35);
  color:var(--ink);font-weight:800;letter-spacing:.3px
}
#btnInfodose:active{transform:translateY(1px)}
.ifr-wrap{width:90vw;max-height:90vh}
@media(min-width:768px){ .ifr-wrap{width:66vw} }

</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="logo"></div>
    <div>
      <div class="title">Dual Mobile Mockup <span class="chip">v0.3</span></div>
      <div class="sub">Cheio de Nada · Local‑first · Ritual 3‑6‑9</div>
    </div>
    <div class="grow"></div>
    <div class="row">
      <img src="assets/icons/voice.svg" alt="" width="18" height="18" />
      <select id="voiceSelect" title="Voz/Arquétipo">
        <option>Nova</option>
        <option>Kaion</option>
        <option>Elysha</option>
        <option>Genus</option>
        <option>Custom (packs)</option>
      </select>
    </div>
    <div class="water" title="Custo d'água (CPU, MEM, LAT, FPS, LTs)">
      <span class="badge">CPU <b id="cpu">~</b></span>
      <span class="badge">MEM <b id="mem">~</b></span>
      <span class="badge">LAT <b id="lat">~</b> ms</span>
      <span class="badge">FPS <b id="fps">~</b></span>
      <span class="badge">LT <b id="lt">0</b></span>
      <span class="badge">CLS <b id="cls">0.00</b></span>
    </div>
    <button class="btn" id="btnPlay">▶︎ Áudio</button>
  </header>

  <main>
    <section class="stage" id="stage">
      <canvas id="layerBack"></canvas>
      <canvas id="layerMid"></canvas>
      <canvas id="layerFore"></canvas>
      <div class="overlay-gestures">double-tap = accent • long-press = 3→6→9 • 2 dedos/2s = Console</div>
    </section>

    <!-- APPS JSON + Sandbox -->
    <section class="apps card" id="appsPane">
      <div class="row">
        <strong>Apps (Cheio de Nada)</strong>
        <div class="grow"></div>
        <button class="btn" id="btnLoadApps">Carregar apps.json</button>
        <button class="btn" id="btnOpenSandbox">Abrir Sandbox</button>
      </div>
      <div id="appsList"></div>
      <div class="sandboxWrap" id="sandboxWrap" style="display:none">
        <iframe class="sandbox" id="sandbox"
          sandbox="allow-scripts allow-forms allow-popups allow-pointer-lock allow-downloads"
          referrerpolicy="no-referrer"
          allow="autoplay; clipboard-read; clipboard-write; fullscreen; gamepad; geolocation; microphone; camera"
        ></iframe>
      </div>
    </section>

    <section class="card" id="packsPane" style="margin:10px">
      <div class="row">
        <strong>Packs (IndexedDB)</strong>
        <div class="grow"></div>
        <input type="file" id="fileImport" accept="application/json,audio/*" multiple />
        <button class="btn" id="btnImport">Importar</button>
        <button class="btn" id="btnExport">Exportar JSON</button>
        <button class="btn" id="btnClear">Limpar</button>
      </div>
      <div id="packsList" style="margin-top:8px"></div>
    </section>

    <div class="console card" id="console" style="display:none"></div>
  </main>

  <nav>
    <button class="btn" id="btnConsole">☰ Console</button>
    <button class="btn" id="btnHotspots">◎ Hotspots</button>
  </nav>

  <div class="toast" id="toast"></div>
</div>

<script>
/* --- Truth / Minus / Trinity --- */
const truth_contract = {
  capabilities:["hotspots_0_1","double_tap","long_press","audio_worklet","canvas_fractal","offline_pwa","apps_json_sandbox","indexeddb_packs","water_badge","voice_presets_fx","voice_selector","pack_player","perf_observer"],
  limits:["ios_haptics_nativo","webgpu_obrigatorio","voz_neural_offline_universal"],
  experiments:[],
  dod:{ single_change_max_time_min:40, iterations_max:3 }
};
const minus={ triggers:{ low_hit:0.12, rare_path:0.05, latency_ms:160 }, actions:["merge_buttons","auto_scale_targets","hide_rare_into_longpress"] };
const trinity369={ cycles:[3,6,9], audio_map:{3:"accent",6:"lift(+2)",9:"expand(+voices)"}, visual_map:{3:"stroke",6:"parallax+5%",9:"strobe_short"}, safety:{max_layers:3, max_rms_db:-12} };

const S={ mode:3, consoleOpen:false, audioReady:false, lastTap:0, longPressTimer:null, phi:0, cpu:"~", mem:"~", lat:"~",
  apps:[], packs:[], fps: "~", lt:0, cls:0.0, rafCount:0, lastFpsT: performance.now(), voice:"Nova" };
const $=sel=>document.querySelector(sel);
const toast=msg=>{ const t=$("#toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1400); };

/* --- Canvas + draw loop --- */
const cvs=[$("#layerBack"),$("#layerMid"),$("#layerFore")]; const ctx=cvs.map(c=>c.getContext("2d"));
function resize(){ for(const c of cvs){ c.width=c.clientWidth*devicePixelRatio; c.height=c.clientHeight*devicePixelRatio; } }
addEventListener("resize", resize, {passive:true}); resize();
let t0=performance.now();
function draw(now){
  const dt=now-t0; t0=now; S.lat=Math.max(1,Math.round(dt));
  // fps
  S.rafCount++; if(now - S.lastFpsT > 1000){ $("#fps").textContent = S.rafCount; S.rafCount=0; S.lastFpsT=now; }
  const w=cvs[0].width,h=cvs[0].height,cx=w/2,cy=h/2; S.phi=(S.phi+dt*0.001)%(Math.PI*2);

  const b=ctx[0]; b.clearRect(0,0,w,h);
  for(let i=0;i<6;i++){ const r=(Math.sin(S.phi*0.7+i)*0.5+0.5)*200+80; const x=cx+Math.cos(S.phi*0.5+i)*w*0.25; const y=cy+Math.sin(S.phi*0.6+i)*h*0.25; const g=b.createRadialGradient(x,y,0,x,y,r); g.addColorStop(0,`rgba(41,211,255,${0.10+i*0.02})`); g.addColorStop(1,"transparent"); b.fillStyle=g; b.beginPath(); b.arc(x,y,r,0,Math.PI*2); b.fill(); }
  const m=ctx[1]; m.clearRect(0,0,w,h); m.lineWidth=2*devicePixelRatio; m.strokeStyle="rgba(255,255,255,0.25)";
  for(let r=40*devicePixelRatio;r<Math.min(w,h)/2;r+=28*devicePixelRatio){ const off=Math.sin(S.phi*1.1+r*0.01)*(S.mode===6? r*0.02 : r*0.01); m.beginPath(); m.arc(cx+off, cy, r, 0, Math.PI*2); m.stroke(); }
  const f=ctx[2]; f.clearRect(0,0,w,h); if(S.mode===9 && Math.sin(S.phi*6)>0.85){ f.fillStyle="rgba(255,90,244,0.22)"; f.fillRect(0,0,w,h); }

  $("#lat").textContent=S.lat;
  requestAnimationFrame(draw);
}
requestAnimationFrame(draw);

/* --- PerformanceObserver: Long Tasks & Layout Shifts (CLS) --- */
if("PerformanceObserver" in window){
  try{
    const poLT = new PerformanceObserver((list)=>{ for(const e of list.getEntries()){ if(e.duration>50){ S.lt++; $("#lt").textContent=S.lt; } } });
    poLT.observe({entryTypes:["longtask"]});
  }catch(e){}
  try{
    let cls = 0;
    const poLS = new PerformanceObserver((list)=>{ for(const e of list.getEntries()){ if(!e.hadRecentInput){ cls += e.value; } } S.cls = cls; $("#cls").textContent = S.cls.toFixed(3); });
    poLS.observe({type:"layout-shift", buffered:true});
  }catch(e){}
}

/* --- Fake CPU/MEM sampler (placeholder; pode trocar por performance.memory quando suportado) --- */
setInterval(()=>{ $("#cpu").textContent=(5+Math.random()*20|0)+"%"; $("#mem").textContent=(80+Math.random()*420|0)+"MB"; }, 1500);

/* --- Audio & Presets & Pack Player --- */
let actx,out,gain,delay,filter,convolver,impulse,currentBuffer, currentSource=null;
const voicePresets = {
  Nova: { pitch:+2,  filter:{type:'highpass', freq:220}, shimmer:0.18 },
  Kaion:{ pitch:-2,  filter:{type:'lowpass',  freq:1800}, shimmer:0.12 },
  Elysha:{ pitch:+4, filter:{type:'bandpass', freq:900}, shimmer:0.22 },
  Genus:{ pitch:0,   filter:{type:'notch',    freq:600}, shimmer:0.08 }
};
let currentVoice="Nova";

async function initAudio(){ if(S.audioReady) return; actx=new (window.AudioContext||window.webkitAudioContext)();
  const workletCode = `class Burst extends AudioWorkletProcessor{ constructor(){super(); this.on=0;} static get parameterDescriptors(){return[{name:'on',defaultValue:0},{name:'freq',defaultValue:220}]}
  process(i,o,p){ const out=o[0]; const on=p.on[0]; const f=p.freq[0]; for(let ch=0; ch<out.length; ch++){ const b=out[ch]; for(let n=0;n<b.length;n++){ let s=0; if(on>0.5){ s=(Math.random()*2-1)*0.18 + Math.sin(2*Math.PI*(currentFrame+n)/sampleRate*f)*0.22; } b[n]=s; } } return true; } } registerProcessor('burst',Burst);`;
  const blob = new Blob([workletCode], {type:'application/javascript'}); await actx.audioWorklet.addModule(URL.createObjectURL(blob));
  out=new AudioWorkletNode(actx,'burst'); gain=actx.createGain(); gain.gain.value=0.0; delay=actx.createDelay(0.75); delay.delayTime.value=0.23; const fb=actx.createGain(); fb.gain.value=0.25; delay.connect(fb).connect(delay);
  filter=actx.createBiquadFilter(); filter.type='highpass'; filter.frequency.value=220;
  convolver=actx.createConvolver(); impulse = makeImpulseResponse(actx, 0.22); convolver.buffer=impulse; const mixVerb=actx.createGain(); mixVerb.gain.value=0.25;
  out.connect(filter); filter.connect(gain); gain.connect(delay).connect(actx.destination); gain.connect(mixVerb).connect(convolver).connect(actx.destination);
  S.audioReady=true; toast('Áudio pronto'); $("#btnPlay").textContent='✓ Áudio';
}
function makeImpulseResponse(ctx, duration){ const rate=ctx.sampleRate; const len=rate*duration|0; const buf=ctx.createBuffer(2,len,rate); for(let ch=0; ch<2; ch++){ const d=buf.getChannelData(ch); for(let i=0;i<len;i++){ d[i]=(Math.random()*2-1)*Math.pow(1-i/len, 2); } } return buf; }
function applyPreset(name){ currentVoice=name; const p=voicePresets[name]||voicePresets.Nova; if(!filter) return; filter.type=p.filter.type; filter.frequency.value=p.filter.freq; S._pitch=p.pitch; S._shimmer=p.shimmer; }
function accent(){ if(!S.audioReady) return; const base=220 + (S.mode===6?2:0)*40 + (S.mode===9?4:0)*40; const pitch=(S._pitch||0)*20; out.parameters.get('freq').setValueAtTime(base+pitch, actx.currentTime); out.parameters.get('on').setValueAtTime(1, actx.currentTime); if(!gain) return; gain.gain.cancelScheduledValues(actx.currentTime); const a=0.9; gain.gain.linearRampToValueAtTime(a, actx.currentTime+0.01); gain.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+0.35); setTimeout(()=> out.parameters.get('on').setValueAtTime(0, actx.currentTime), 120); }

$("#btnPlay").addEventListener("click", async ()=>{ await initAudio(); if(actx.state==='suspended') await actx.resume(); accent(); });
$("#voiceSelect").addEventListener("change", (e)=>{ applyPreset(e.target.value.split(' ')[0]); toast('Voz: '+e.target.value); });

/* --- IndexedDB Packs --- */
const DB={ name:'dual-packs', ver:1, db:null};
function idbOpen(){ return new Promise((res,rej)=>{ const r=indexedDB.open(DB.name, DB.ver); r.onupgradeneeded=ev=>{ const db=ev.target.result; if(!db.objectStoreNames.contains('packs')) db.createObjectStore('packs', {keyPath:'id'}); }; r.onsuccess=ev=>{ DB.db=ev.target.result; res(DB.db); }; r.onerror=()=>rej(r.error); }); }
async function idbGetAll(){ await idbOpen(); return new Promise(res=>{ const tx=DB.db.transaction('packs','readonly'); const st=tx.objectStore('packs'); const req=st.getAll(); req.onsuccess=()=>res(req.result||[]); }); }
async function idbPut(pack){ await idbOpen(); return new Promise(res=>{ const tx=DB.db.transaction('packs','readwrite'); tx.objectStore('packs').put(pack); tx.oncomplete=()=>res(true); }); }
async function idbClear(){ await idbOpen(); return new Promise(res=>{ const tx=DB.db.transaction('packs','readwrite'); tx.objectStore('packs').clear(); tx.oncomplete=()=>res(true); }); }

async function loadPacks(){ S.packs=await idbGetAll(); renderPacks(); }
function renderPacks(){
  const box=$("#packsList");
  if(!S.packs.length){ box.innerHTML='<em>Nenhum pack armazenado.</em>'; return; }
  box.innerHTML = "";
  S.packs.forEach((p,i)=>{
    const row=document.createElement('div'); row.className='row'; row.style.gap='8px';
    const btn=document.createElement('button'); btn.className='btn'; btn.textContent='▶︎ Reproduzir';
    btn.onclick=()=> playPack(p);
    const meta=document.createElement('div'); meta.innerHTML = `<strong>${p.name||p.id}</strong><div class="chip">${p.type}</div>`;
    row.appendChild(btn); row.appendChild(meta);
    box.appendChild(row);
  });
}
async function playPack(p){
  await initAudio(); if(actx.state==='suspended') await actx.resume();
  if(!p || !p.data){ toast('Pack sem dados'); return; }
  try{
    const bin = p.type==='json' ? new TextEncoder().encode(JSON.stringify(p.data)).buffer : Uint8Array.from(atob(p.data), c=>c.charCodeAt(0)).buffer;
    const buf = await actx.decodeAudioData(bin.slice(0)); // if not audio will throw
    if(currentSource){ try{ currentSource.stop(); }catch(e){} }
    currentBuffer = buf;
    currentSource = actx.createBufferSource(); currentSource.buffer = currentBuffer; currentSource.loop = true;
    const vol = actx.createGain(); vol.gain.value = 0.6;
    currentSource.connect(vol).connect(filter).connect(gain); // reuse FX chain
    currentSource.start();
    toast('Reproduzindo pack: '+(p.name||p.id));
  }catch(e){
    console.warn('Decode fail (provável JSON, não áudio).', e);
    toast('Esse pack não é áudio (JSON).');
  }
}
function stopPack(){ if(currentSource){ try{ currentSource.stop(); }catch(e){} currentSource=null; } }

$("#btnImport").onclick=async()=>{
  const files=$("#fileImport").files;
  if(!files?.length){ toast('Selecione arquivos'); return; }
  for(const f of files){
    if(f.type.startswith && f.type.startswith('audio/')){ // some browsers
      const arr=await f.arrayBuffer(); const b64=btoa(String.fromCharCode(...new Uint8Array(arr)));
      await idbPut({ id:`wav:${f.name}`, type:f.type||'audio/wav', name:f.name, data:b64 });
    } else if(f.type.startsWith('audio/')){
      const arr=await f.arrayBuffer(); const b64=btoa(String.fromCharCode(...new Uint8Array(arr)));
      await idbPut({ id:`wav:${f.name}`, type:f.type||'audio/wav', name:f.name, data:b64 });
    } else {
      try{ const txt=await f.text(); const json=JSON.parse(txt); await idbPut({ id:`json:${f.name}`, type:'json', name:f.name, data:json }); }
      catch(e){ console.warn('JSON inválido', e); }
    }
  }
  await loadPacks(); toast('Importado');
};
$("#btnExport").onclick=async()=>{
  const data=await idbGetAll(); const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='dual_packs_export.json'; a.click(); toast('Exportado');
};
$("#btnClear").onclick=async()=>{ await idbClear(); S.packs=[]; renderPacks(); stopPack(); toast('Packs limpos'); };

/* --- Apps.json + sandbox --- */
$("#btnLoadApps").onclick=async()=>{ try{ const res=await fetch('apps/apps.json'); const json=await res.json(); S.apps=json.apps||json; renderApps(); toast('apps.json carregado'); }catch(e){ toast('Falha ao carregar apps.json'); console.error(e); } };
function renderApps(){ const list=$("#appsList"); list.innerHTML=''; const df=new DocumentFragment(); (S.apps||[]).forEach((a,i)=>{ const row=document.createElement('div'); row.className='appItem'; row.innerHTML=`<span class="chip">#${i+1}</span><div><div><strong>${a.name||'App'}</strong></div><div class="meta">${a.url}</div></div><div class="grow"></div><button class="btn" data-open="${i}">Abrir</button>`; df.appendChild(row); }); list.appendChild(df); list.onclick=e=>{ const i=e.target?.dataset?.open; if(i!=null){ openSandbox(S.apps[i]); } } }
function openSandbox(app){ const f=$("#sandbox"); $("#sandboxWrap").style.display='block'; f.src = app.url; f.setAttribute('title', app.name||'sandbox'); }
$("#btnOpenSandbox").onclick=()=>{ const el=$("#sandboxWrap"); el.style.display = (el.style.display==='none'?'block':'none'); };

/* --- Console --- */
$("#btnConsole").onclick=()=>{ S.consoleOpen=!S.consoleOpen; const c=$("#console"); c.style.display=S.consoleOpen?'block':'none'; c.innerHTML='<pre>'+JSON.stringify({truth_contract, minus, trinity369, metrics:{cpu:$("#cpu").textContent, mem:$("#mem").textContent, lat:S.lat, fps:$("#fps").textContent, lt:S.lt, cls:S.cls}, voice:S.voice, apps:S.apps.map(a=>a.name), packs:S.packs.map(p=>p.id)}, null, 2)+'</pre>'; };

/* --- Hotspots (visual toggle only) --- */
$("#btnHotspots").onclick=()=>{
  toast('Hotspots visuais (mock)');
};

/* --- PWA SW inline --- */
if('serviceWorker' in navigator){
  const swCode=`self.addEventListener('install',e=>{e.waitUntil(caches.open('dual-mock-v3').then(c=>c.addAll(['./','apps/apps.json']).catch(()=>{})))});self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))})`;
  const url=URL.createObjectURL(new Blob([swCode],{type:'text/javascript'})); navigator.serviceWorker.register(url);
}
</script>

<!-- Botão Único (auto-injetado v0.4) -->
<button id="btnInfodose" title="KOBLLUX — Botão Único">☰</button>

</body>
</html>
